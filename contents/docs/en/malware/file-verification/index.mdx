---
title: File Verification
description: Methods to verify file integrity and authenticity
---

## Why File Verification?

- Detect tampering
- Ensure authenticity
- Verify downloads
- Check integrity
- Prevent malware

## Hash Functions

### MD5 (Message Digest 5)
```bash
# Calculate MD5
md5sum file.exe
# Output: 5d41402abc4b2a76b9719d911017c592

# Verify against known hash
echo "5d41402abc4b2a76b9719d911017c592  file.exe" | md5sum -c
```

**Note**: MD5 is deprecated due to collision vulnerabilities. Use for non-security purposes only.

### SHA-1 (Secure Hash Algorithm 1)
```bash
# Calculate SHA-1
sha1sum file.exe

# Verify
echo "hash_value  file.exe" | sha1sum -c
```

**Note**: SHA-1 is also deprecated. Better than MD5 but not recommended for security.

### SHA-256 (Recommended)
```bash
# Calculate SHA-256
sha256sum file.exe

# Verify multiple files
sha256sum -c checksums.txt

# Create checksum file
sha256sum *.exe > checksums.txt
```

### SHA-512 (Most Secure)
```bash
# Calculate SHA-512
sha512sum file.exe

# Verify
sha512sum -c file.sha512
```

## Digital Signatures

### Windows Authenticode
```powershell
# Check signature
Get-AuthenticodeSignature file.exe | Format-List

# Verify signature
(Get-AuthenticodeSignature file.exe).Status
# Valid = Signed and verified
# NotSigned = No signature
# Invalid = Signature tampered
```

### Linux GPG Signatures
```bash
# Import public key
gpg --import public_key.asc

# Verify signature
gpg --verify file.sig file.tar.gz

# Sign a file
gpg --detach-sign file.tar.gz
```

## File Integrity Monitoring

### AIDE (Advanced Intrusion Detection Environment)
```bash
# Install
sudo apt install aide

# Initialize database
sudo aideinit

# Check for changes
sudo aide --check

# Update database
sudo aide --update
```

### Tripwire
```bash
# Install
sudo apt install tripwire

# Initialize
sudo tripwire --init

# Check integrity
sudo tripwire --check

# Update database
sudo tripwire --update
```

### Configuration Example
```conf
# /etc/aide/aide.conf
/bin p+i+n+u+g+s+b+m+c+md5+sha256
/sbin p+i+n+u+g+s+b+m+c+md5+sha256
/usr/bin p+i+n+u+g+s+b+m+c+md5+sha256
/etc p+i+n+u+g+s+b+m+c+md5+sha256

# p = permissions
# i = inode
# n = number of links
# u = user
# g = group
# s = size
# b = block count
# m = mtime
# c = ctime
# md5 = md5 checksum
# sha256 = sha256 checksum
```

## Windows File Verification

### PowerShell
```powershell
# Calculate file hash
Get-FileHash -Path file.exe -Algorithm SHA256

# Compare hashes
$hash1 = (Get-FileHash file1.exe).Hash
$hash2 = (Get-FileHash file2.exe).Hash
if ($hash1 -eq $hash2) { Write-Host "Files match" }

# Verify multiple files
Get-ChildItem *.exe | Get-FileHash | Export-Csv hashes.csv
```

### Command Line
```cmd
# Built-in certutil
certutil -hashfile file.exe MD5
certutil -hashfile file.exe SHA256
```

## Verifying Downloaded Files

### Example: Linux ISO
```bash
# Download ISO and checksum
wget https://example.com/ubuntu.iso
wget https://example.com/SHA256SUMS
wget https://example.com/SHA256SUMS.gpg

# Verify GPG signature on checksum file
gpg --keyserver keys.openpgp.org --recv-keys KEY_ID
gpg --verify SHA256SUMS.gpg SHA256SUMS

# Verify ISO hash
sha256sum -c SHA256SUMS
```

## Code Signing

### Sign PowerShell Script
```powershell
# Get certificate
$cert = Get-ChildItem Cert:\CurrentUser\My -CodeSigningCert

# Sign script
Set-AuthenticodeSignature -FilePath script.ps1 -Certificate $cert

# Verify
Get-AuthenticodeSignature script.ps1
```

### Verify Executable
```bash
# Linux: Check ELF signature
readelf -n binary

# Check codesign (macOS)
codesign -v -v /path/to/app

# Detailed info
codesign -d -vvv /path/to/app
```

## Online Verification

### VirusTotal
```bash
# Upload and check
curl --request POST \
  --url 'https://www.virustotal.com/api/v3/files' \
  --header 'x-apikey: YOUR_API_KEY' \
  --form file=@suspicious.exe

# Check by hash
curl --request GET \
  --url "https://www.virustotal.com/api/v3/files/FILE_HASH" \
  --header 'x-apikey: YOUR_API_KEY'
```

## Best Practices

1. **Always verify downloads** from checksums/signatures
2. **Use SHA-256 or higher** for new implementations
3. **Implement file integrity monitoring** on critical systems
4. **Check digital signatures** on executables
5. **Keep verification tools updated**
6. **Automate verification** in deployment pipelines
7. **Document expected hashes** for important files

## Automated Verification

### Script Example
```bash
#!/bin/bash
# verify_downloads.sh

CHECKSUMS="checksums.txt"

while IFS= read -r line; do
    expected_hash=$(echo $line | awk '{print $1}')
    filename=$(echo $line | awk '{print $2}')
    
    if [ -f "$filename" ]; then
        actual_hash=$(sha256sum "$filename" | awk '{print $1}')
        
        if [ "$expected_hash" == "$actual_hash" ]; then
            echo "✓ $filename: OK"
        else
            echo "✗ $filename: MISMATCH"
        fi
    else
        echo "✗ $filename: NOT FOUND"
    fi
done < "$CHECKSUMS"
```

## Resources

- NIST FIPS 180-4 (SHA standard)
- GPG Documentation
- AIDE Manual
- Authenticode specification
