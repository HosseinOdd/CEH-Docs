---
title: Malware Analysis
description: Static and dynamic malware analysis techniques
---

## Types of Analysis

### Static Analysis
- Examine without execution
- File properties, strings, code structure
- Safer approach
- Limited insights

### Dynamic Analysis
- Execute in controlled environment
- Observe behavior and actions
- More comprehensive
- Requires sandboxing

### Hybrid Analysis
- Combination of both methods
- Complete understanding

## Static Analysis Techniques

### File Information
```bash
# File type
file malware.exe
# Output: PE32 executable (console) Intel 80386, for MS Windows

# File size and properties
ls -lh malware.exe
stat malware.exe

# Calculate hashes
md5sum malware.exe
sha256sum malware.exe
```

### Strings Extraction
```bash
# Extract readable strings
strings malware.exe > strings.txt

# Search for specific patterns
strings malware.exe | grep -i "http"
strings malware.exe | grep -i "password"
strings malware.exe | grep -E "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"

# Unicode strings
strings -el malware.exe
```

### PE Analysis (Windows)
```bash
# Using pefile (Python)
pip install pefile

python3 << EOF
import pefile
pe = pefile.PE('malware.exe')
print(f"Entry Point: {hex(pe.OPTIONAL_HEADER.AddressOfEntryPoint)}")
print(f"Image Base: {hex(pe.OPTIONAL_HEADER.ImageBase)}")
print("Sections:")
for section in pe.sections:
    print(f"  {section.Name.decode()}: {hex(section.VirtualAddress)}")
print("Imports:")
for entry in pe.DIRECTORY_ENTRY_IMPORT:
    print(f"  {entry.dll.decode()}")
    for imp in entry.imports:
        print(f"    {imp.name.decode() if imp.name else 'N/A'}")
EOF
```

### Disassembly
```bash
# objdump (Linux binary)
objdump -d malware.elf

# IDA Pro (commercial)
# Ghidra (free, NSA tool)
# radare2 (open-source)
```

### Hex Dump
```bash
# View hex dump
hexdump -C malware.exe | less

# xxd
xxd malware.exe | less

# Search for specific bytes
hexdump -C malware.exe | grep "MZ"  # PE header
```

## Dynamic Analysis Setup

### Isolated Environment
- Virtual machine
- Network isolation
- Snapshot capability
- Monitoring tools installed

### VM Configuration
```bash
# Take snapshot before analysis
VBoxManage snapshot "Analysis_VM" take "clean_state"

# Restore snapshot after analysis
VBoxManage snapshot "Analysis_VM" restore "clean_state"
```

### Fakenet/INetSim
```bash
# Install INetSim (Linux)
sudo apt install inetsim

# Start fake services
sudo inetsim

# Configuration
# /etc/inetsim/inetsim.conf
service dns
service http
service smtp
```

## Dynamic Analysis Techniques

### Process Monitoring
```bash
# Linux: strace
strace -f -o trace.log ./malware

# System call analysis
strace -c ./malware  # Summary

# ltrace (library calls)
ltrace ./malware

# Windows: Process Monitor (Procmon)
```

### File System Monitoring
```bash
# inotify (Linux)
inotifywait -m -r /tmp

# Audit files created/modified
auditctl -w /etc -p wa -k etc_changes
```

### Network Analysis
```bash
# Capture traffic
tcpdump -i any -w capture.pcap

# Wireshark analysis
wireshark capture.pcap

# Monitor connections
netstat -antp
ss -tulpn

# DNS queries
tcpdump -i any port 53
```

### Registry Monitoring (Windows)
```powershell
# Regshot - Compare registry before/after
# Process Monitor filters:
# Operation: RegSetValue
# Operation: RegCreateKey
```

### Memory Analysis
```bash
# Dump process memory
sudo gcore PID

# Volatility framework
volatility -f memory.dump imageinfo
volatility -f memory.dump pslist
volatility -f memory.dump pstree
volatility -f memory.dump cmdline
volatility -f memory.dump netscan
volatility -f memory.dump malfind
```

## Automated Analysis Tools

### Cuckoo Sandbox
```bash
# Install Cuckoo
pip install -U cuckoo

# Initialize
cuckoo init

# Submit sample
cuckoo submit malware.exe

# Web interface
cuckoo web
```

### Any.run
- Online interactive sandbox
- Real-time analysis
- Browser-based

### Joe Sandbox
- Cloud-based analysis
- Detailed reports
- Multiple OS support

### Hybrid Analysis
- Free online service
- Automated analysis
- Community submissions

## Analysis Workflow

### 1. Preparation
- Set up isolated environment
- Take VM snapshot
- Prepare monitoring tools
- Document baseline

### 2. Static Analysis
- File properties and hashes
- Strings extraction
- PE/ELF analysis
- Disassembly review

### 3. Dynamic Analysis
- Execute in sandbox
- Monitor file operations
- Capture network traffic
- Record registry changes
- Analyze behavior

### 4. Documentation
- IOCs (Indicators of Compromise)
- TTPs (Tactics, Techniques, Procedures)
- Network signatures
- File modifications

### 5. Cleanup
- Restore snapshot
- Save analysis artifacts
- Update detection rules

## Tools Collection

### Static Analysis
- **PEiD**: Packer detection
- **Detect It Easy (DIE)**: File analyzer
- **pestudio**: PE analysis
- **Ghidra**: Disassembler/decompiler
- **IDA Pro**: Commercial disassembler
- **radare2**: Reverse engineering framework

### Dynamic Analysis
- **Process Monitor**: Windows system monitor
- **Process Explorer**: Task manager replacement
- **API Monitor**: API call tracking
- **Wireshark**: Network analyzer
- **Regshot**: Registry comparison
- **Fakenet-NG**: Network simulator

### Debuggers
- **x64dbg/x32dbg**: Windows debugger
- **OllyDbg**: Classic Windows debugger
- **GDB**: GNU debugger (Linux)
- **WinDbg**: Microsoft debugger

### All-in-One
- **REMnux**: Linux distro for malware analysis
- **FLARE VM**: Windows VM for analysis

## Anti-Analysis Techniques

### Detection
- VM detection
- Debugger detection
- Sandbox evasion
- Time-based evasion

### Obfuscation
- Packing/encryption
- Code obfuscation
- String encryption
- API hashing

### Countering Anti-Analysis
- Modify VM artifacts
- Patch anti-debug checks
- Use hidden debuggers
- Timing manipulation

## Reporting

### Key Elements
1. **Executive Summary**
2. **Technical Details**
   - File information
   - Behavior analysis
   - Network activity
   - Persistence mechanisms
3. **IOCs**
   - File hashes
   - IP addresses
   - Domain names
   - Registry keys
   - File paths
4. **Recommendations**
   - Detection rules
   - Mitigation steps
   - Prevention measures

## Resources

- Malware Analysis Book (Michael Sikorski)
- Practical Malware Analysis
- REMnux: https://remnux.org
- FLARE VM: https://github.com/mandiant/flare-vm
- Cuckoo Sandbox: https://cuckoosandbox.org
