---
title: تایید فایل
description: روش‌ها برای تأیید یکپارچگی و اصالت فایل
---

## چرا تایید فایل؟

- تشخیص دستکاری
- اطمینان از اصالت
- تأیید دانلودها
- بررسی یکپارچگی
- جلوگیری از بدافزار

## توابع هش

### MD5 (Message Digest 5)
```bash
# محاسبه MD5
md5sum file.exe
# خروجی: 5d41402abc4b2a76b9719d911017c592

# تأیید در برابر هش شناخته شده
echo "5d41402abc4b2a76b9719d911017c592  file.exe" | md5sum -c
```

**نکته**: MD5 به دلیل آسیب‌پذیری‌های تصادم منسوخ شده است. فقط برای اهداف غیرامنیتی استفاده کنید.

### SHA-1
```bash
# محاسبه SHA-1
sha1sum file.exe

# تأیید
echo "hash_value  file.exe" | sha1sum -c
```

**نکته**: SHA-1 نیز منسوخ شده است. بهتر از MD5 اما برای امنیت توصیه نمی‌شود.

### SHA-256 (توصیه شده)
```bash
# محاسبه SHA-256
sha256sum file.exe

# تأیید چندین فایل
sha256sum -c checksums.txt

# ایجاد فایل checksum
sha256sum *.exe > checksums.txt
```

### SHA-512 (امن‌ترین)
```bash
# محاسبه SHA-512
sha512sum file.exe

# تأیید
sha512sum -c file.sha512
```

## امضاهای دیجیتال

### Windows Authenticode
```powershell
# بررسی امضا
Get-AuthenticodeSignature file.exe | Format-List

# تأیید امضا
(Get-AuthenticodeSignature file.exe).Status
# Valid = امضا شده و تأیید شده
# NotSigned = بدون امضا
# Invalid = امضا دستکاری شده
```

### امضاهای GPG در Linux
```bash
# وارد کردن کلید عمومی
gpg --import public_key.asc

# تأیید امضا
gpg --verify file.sig file.tar.gz

# امضای یک فایل
gpg --detach-sign file.tar.gz
```

## نظارت یکپارچگی فایل

### AIDE
```bash
# نصب
sudo apt install aide

# راه‌اندازی پایگاه داده
sudo aideinit

# بررسی تغییرات
sudo aide --check

# به‌روزرسانی پایگاه داده
sudo aide --update
```

### Tripwire
```bash
# نصب
sudo apt install tripwire

# راه‌اندازی
sudo tripwire --init

# بررسی یکپارچگی
sudo tripwire --check

# به‌روزرسانی پایگاه داده
sudo tripwire --update
```

### مثال پیکربندی
```ini
# /etc/aide/aide.conf
/bin p+i+n+u+g+s+b+m+c+md5+sha256
/sbin p+i+n+u+g+s+b+m+c+md5+sha256
/usr/bin p+i+n+u+g+s+b+m+c+md5+sha256
/etc p+i+n+u+g+s+b+m+c+md5+sha256

# p = مجوزها
# i = inode
# n = تعداد لینک‌ها
# u = کاربر
# g = گروه
# s = اندازه
# b = تعداد بلاک
# m = mtime
# c = ctime
# md5 = checksum md5
# sha256 = checksum sha256
```

## تایید فایل Windows

### PowerShell
```powershell
# محاسبه هش فایل
Get-FileHash -Path file.exe -Algorithm SHA256

# مقایسه هش‌ها
$hash1 = (Get-FileHash file1.exe).Hash
$hash2 = (Get-FileHash file2.exe).Hash
if ($hash1 -eq $hash2) { Write-Host "Files match" }

# تأیید چندین فایل
Get-ChildItem *.exe | Get-FileHash | Export-Csv hashes.csv
```

### خط فرمان
```batch
# certutil داخلی
certutil -hashfile file.exe MD5
certutil -hashfile file.exe SHA256
```

## تأیید فایل‌های دانلود شده

### مثال: ISO لینوکس
```bash
# دانلود ISO و checksum
wget https://example.com/ubuntu.iso
wget https://example.com/SHA256SUMS
wget https://example.com/SHA256SUMS.gpg

# تأیید امضای GPG در فایل checksum
gpg --keyserver keys.openpgp.org --recv-keys KEY_ID
gpg --verify SHA256SUMS.gpg SHA256SUMS

# تأیید هش ISO
sha256sum -c SHA256SUMS
```

## امضای کد

### امضای اسکریپت PowerShell
```powershell
# دریافت گواهی
$cert = Get-ChildItem Cert:\CurrentUser\My -CodeSigningCert

# امضای اسکریپت
Set-AuthenticodeSignature -FilePath script.ps1 -Certificate $cert

# تأیید
Get-AuthenticodeSignature script.ps1
```

### تأیید اجرایی
```bash
# Linux: بررسی امضای ELF
readelf -n binary

# بررسی codesign (macOS)
codesign -v -v /path/to/app

# اطلاعات دقیق
codesign -d -vvv /path/to/app
```

## تایید آنلاین

### VirusTotal
```bash
# آپلود و بررسی
curl --request POST \
  --url 'https://www.virustotal.com/api/v3/files' \
  --header 'x-apikey: YOUR_API_KEY' \
  --form file=@suspicious.exe

# بررسی با هش
curl --request GET \
  --url "https://www.virustotal.com/api/v3/files/FILE_HASH" \
  --header 'x-apikey: YOUR_API_KEY'
```

## بهترین روش‌ها

1. **همیشه دانلودها را تأیید کنید** از checksums/امضاها
2. **از SHA-256 یا بالاتر استفاده کنید** برای پیاده‌سازی‌های جدید
3. **نظارت یکپارچگی فایل را پیاده‌سازی کنید** در سیستم‌های بحرانی
4. **امضاهای دیجیتال را بررسی کنید** در اجرایی‌ها
5. **ابزارهای تأیید را به‌روز نگه دارید**
6. **تأیید را خودکار کنید** در پایپ‌لاین‌های استقرار
7. **هش‌های مورد انتظار را مستند کنید** برای فایل‌های مهم

## تایید خودکار

### مثال اسکریپت
```bash
#!/bin/bash
# verify_downloads.sh

CHECKSUMS="checksums.txt"

while IFS= read -r line; do
    expected_hash=$(echo $line | awk '{print $1}')
    filename=$(echo $line | awk '{print $2}')
    
    if [ -f "$filename" ]; then
        actual_hash=$(sha256sum "$filename" | awk '{print $1}')
        
        if [ "$expected_hash" == "$actual_hash" ]; then
            echo "✓ $filename: OK"
        else
            echo "✗ $filename: MISMATCH"
        fi
    else
        echo "✗ $filename: NOT FOUND"
    fi
done < "$CHECKSUMS"
```

## منابع

- NIST FIPS 180-4 (استاندارد SHA)
- مستندات GPG
- راهنمای AIDE
- مشخصات Authenticode
