---
title: چرخه حیات بدافزار
description: درک مراحل عفونت و انتشار بدافزار
---

## مراحل چرخه حیات بدافزار

### 1. عفونت اولیه
**نقاط ورود:**
- پیوست‌های ایمیل
- دانلودهای مخرب
- دانلودهای خودکار
- USB/رسانه قابل جابجایی
- بهره‌برداری از شبکه
- مهندسی اجتماعی

### 2. اجرا
- کاربر بدافزار را فعال می‌کند
- اکسپلویت اجرا را فعال می‌کند
- ویژگی‌های auto-run
- وظایف زمان‌بندی شده

### 3. پایداری
**تکنیک‌ها:**
```bash
# رجیستری (Windows)
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run

# Cron jobs (Linux)
crontab -e
@reboot /path/to/malware

# سرویس‌های Systemd
/etc/systemd/system/malware.service
```

### 4. افزایش امتیاز
- بهره‌برداری از آسیب‌پذیری‌ها
- سرقت اعتبارنامه
- دستکاری توکن
- ربودن DLL

### 5. فرار از دفاع
- غیرفعال کردن آنتی‌ویروس
- پاک کردن لاگ‌ها
- نصب روت‌کیت
- تزریق پروسس

### 6. کشف
- اسکن شبکه
- شمارش سیستم
- کشف کاربر/حساب
- شمارش فایل/دایرکتوری

### 7. حرکت جانبی
- دامپ اعتبارنامه
- سرویس‌های از راه دور
- Pass-the-hash
- پیوت از طریق سیستم‌ها

### 8. جمع‌آوری
- مرحله‌بندی داده
- ضبط صفحه
- ثبت کلید
- داده کلیپ‌بورد

### 9. استخراج
- کانال‌های HTTP/HTTPS
- تونل‌سازی DNS
- FTP/SFTP
- سرویس‌های ابری

### 10. تأثیر
- تخریب داده
- رمزگذاری (باج‌افزار)
- ربودن منابع
- انکار سرویس

## مکانیزم‌های پایداری

### Windows
```powershell
# کلیدهای Run
New-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" -Name "Malware" -Value "C:\malware.exe"

# وظایف زمان‌بندی شده
schtasks /create /tn "Malware" /tr "C:\malware.exe" /sc onlogon

# سرویس‌ها
sc create MalwareService binPath= "C:\malware.exe" start= auto
```

### Linux
```bash
# Cron jobs
echo "@reboot /tmp/malware" | crontab -

# سرویس Systemd
cat > /etc/systemd/system/malware.service <<EOF
[Unit]
Description=Malware Service
[Service]
ExecStart=/tmp/malware
[Install]
WantedBy=multi-user.target
EOF
systemctl enable malware.service

# rc.local
echo "/tmp/malware &" >> /etc/rc.local
```

## مدل Kill Chain

### Lockheed Martin Cyber Kill Chain
1. **شناسایی**: تحقیق هدف
2. **تسلیح‌سازی**: ایجاد اکسپلویت
3. **تحویل**: انتقال به قربانی
4. **بهره‌برداری**: اجرای کد
5. **نصب**: نصب بدافزار
6. **فرمان و کنترل**: ارتباط C2
7. **اقدامات بر اهداف**: دستیابی به هدف

## چارچوب MITRE ATT&CK

### تاکتیک‌ها
- دسترسی اولیه
- اجرا
- پایداری
- افزایش امتیاز
- فرار از دفاع
- دسترسی اعتبارنامه
- کشف
- حرکت جانبی
- جمع‌آوری
- فرمان و کنترل
- استخراج
- تأثیر

## نقاط تشخیص

### مرحله اولیه
- ناهنجاری‌های شبکه
- ایمیل‌های مشکوک
- دانلودهای ناشناخته

### مرحله میانی
- رفتار پروسس
- تغییرات رجیستری
- سرویس‌های جدید
- اتصالات شبکه

### مرحله پایانی
- استخراج داده
- تغییرات سیستم
- کاهش عملکرد

## پاسخ به حادثه

### آمادگی
- برنامه IR
- ابزارهای آماده
- تیم آموزش دیده

### شناسایی
- تشخیص حادثه
- تجزیه و تحلیل دامنه
- جمع‌آوری مدرک

### مهار
- جداسازی سیستم‌ها
- توقف انتشار
- حفظ مدرک

### ریشه‌کنی
- حذف بدافزار
- وصله آسیب‌پذیری‌ها
- تقویت دفاع‌ها

### بازیابی
- بازیابی سیستم‌ها
- نظارت برای عفونت مجدد
- تأیید یکپارچگی

### درس‌های آموخته شده
- مستندسازی حادثه
- بهبود فرآیندها
- به‌روزرسانی دفاع‌ها

## تحلیل خط زمانی

```
T+0:    عفونت اولیه
T+5m:   اجرا شروع می‌شود
T+10m:  پایداری برقرار می‌شود
T+30m:  حرکت جانبی
T+1h:   جمع‌آوری داده
T+2h:   تلاش برای استخراج
T+3h:   تشخیص (در حالت ایده‌آل)
```

## منابع

- MITRE ATT&CK: https://attack.mitre.org
- Cyber Kill Chain
- راهنمای پاسخ به حادثه NIST
