---
title: مقدمه شنود
description: شنود بسته‌های شبکه، پروتکل‌ها و تکنیک‌های حمله
---

## شنود چیست؟

شنود شبکه (packet sniffing) فرآیند ضبط و تجزیه و تحلیل ترافیک شبکه است. می‌تواند برای اهداف قانونی (عیب‌یابی شبکه، نظارت امنیتی) یا اهداف مخرب (سرقت اعتبارنامه، استراق سمع) استفاده شود.

## نحوه کار شنود

### ارتباط شبکه
- داده‌ها در بسته‌ها حرکت می‌کنند
- بسته‌ها شامل هدر و payload هستند
- هدرها شامل اطلاعات مبدأ/مقصد
- Payload شامل داده‌های واقعی

### توپولوژی‌های شبکه

#### شبکه‌های مبتنی بر Hub
- به همه پورت‌ها پخش می‌کند
- شنود آسان
- همه دستگاه‌ها همه ترافیک را می‌بینند
- **فناوری منسوخ شده**

#### شبکه‌های مبتنی بر Switch
- فقط به پورت‌های خاص ارسال می‌کند
- از جدول آدرس MAC استفاده می‌کند (CAM)
- امن‌تر از hub
- نیاز به تکنیک‌های حمله برای شنود

## انواع شنود

### شنود غیرفعال (Passive)
- نظارت بر ترافیک بدون تعامل
- در شبکه‌های hub کار می‌کند
- ساکت و غیرقابل تشخیص
- محدود به دامنه broadcast

### شنود فعال (Active)
- تزریق بسته برای ضبط ترافیک
- برای شبکه‌های سوئیچ شده لازم
- جعل ARP، سیل MAC
- قابل تشخیص

## پروتکل‌های آسیب‌پذیر به شنود

### پروتکل‌های رمزگذاری نشده
- **HTTP**: ترافیک وب (اعتبارنامه، داده)
- **FTP**: انتقال فایل (نام‌کاربری/رمز)
- **Telnet**: دسترسی از راه دور (متن ساده)
- **SMTP**: ایمیل (پیام‌ها، اعتبارنامه)
- **POP3/IMAP**: بازیابی ایمیل
- **DNS**: کوئری‌های دامنه

### پروتکل‌های تا حدی امن
- **HTTPS**: رمزگذاری شده، اما متادیتا قابل مشاهده
- **SSH**: رمزگذاری شده، اطلاعات اتصال قابل مشاهده
- **VPN**: تونل رمزگذاری شده، نقاط پایانی قابل مشاهده

## چه چیزی قابل ضبط است؟

### اعتبارنامه‌ها
```
POST /login HTTP/1.1
Host: example.com
Content-Type: application/x-www-form-urlencoded

username=admin&password=secret123
```

### محتوای ایمیل
```
MAIL FROM: sender@example.com
RCPT TO: victim@example.com
DATA
Subject: Confidential
This is sensitive information...
```

### کوکی‌های نشست
```
GET / HTTP/1.1
Host: website.com
Cookie: sessionid=abc123xyz789
```

### انتقال فایل
- دانلود/آپلود FTP
- انتقال فایل HTTP
- پیوست‌های رمزگذاری نشده

## ابزارهای شنود

### ابزارهای خط فرمان

#### tcpdump
```bash
# ضبط همه ترافیک
sudo tcpdump -i eth0

# ذخیره در فایل
sudo tcpdump -i eth0 -w capture.pcap

# فیلتر بر اساس پروتکل
sudo tcpdump -i eth0 tcp port 80

# خواندن از فایل
tcpdump -r capture.pcap
```

#### Wireshark (TShark CLI)
```bash
# ضبط ترافیک
tshark -i eth0 -w capture.pcap

# فیلترهای نمایش
tshark -r capture.pcap -Y "http.request"

# استخراج اشیاء HTTP
tshark -r capture.pcap --export-objects http,output_dir
```

### ابزارهای GUI

#### Wireshark
- محبوب‌ترین آنالایزر بسته
- رابط گرافیکی
- تجزیه پروتکل
- فیلتر پیشرفته
- دنبال کردن جریان‌های TCP

#### Ettercap
- حملات MITM
- مسمومیت ARP
- فیلتر محتوا
- پشتیبانی افزونه

#### Cain & Abel (Windows)
- بازیابی رمز عبور
- شنود شبکه
- مسمومیت ARP
- ضبط VoIP

## حملات شبکه برای شنود

### سیل MAC (MAC Flooding)
- سرریز جدول CAM سوئیچ
- سوئیچ مانند hub عمل می‌کند
- همه ترافیک پخش می‌شود

### جعل/مسمومیت ARP
- ارسال پاسخ‌های ARP جعلی
- ارتباط MAC مهاجم با IP هدف
- هدایت ترافیک از طریق مهاجم

### خستگی DHCP
- تمام کردن استخر DHCP
- مجبور کردن قربانیان به DHCP جعلی
- کنترل تنظیمات شبکه

### جعل DNS
- پاسخ‌های DNS جعلی
- هدایت به سایت‌های مخرب
- برداشت اعتبارنامه

### MITM (مرد-در-میانه)
- قرارگیری بین کلاینت و سرور
- رهگیری و تغییر ترافیک
- حملات SSL stripping

## حملات شبکه سوئیچ شده

### سرریز جدول CAM
```bash
# استفاده از macof
macof -i eth0 -s 10.0.0.1 -d 10.0.0.2

# سیل سوئیچ با آدرس‌های MAC جعلی
```

### مسمومیت کش ARP
```bash
# استفاده از arpspoof
arpspoof -i eth0 -t victim_ip gateway_ip
arpspoof -i eth0 -t gateway_ip victim_ip

# فعال کردن فوروارد IP
echo 1 > /proc/sys/net/ipv4/ip_forward
```

## روش‌های تشخیص

### تشخیص مبتنی بر شبکه

#### نظارت ARP
- تشخیص IPهای تکراری با MACهای مختلف
- نظارت بر تغییرات کش ARP
- هشدار در مورد ترافیک غیرعادی ARP

#### تحلیل ترافیک
- الگوهای غیرعادی بسته
- تشخیص حالت promiscuous
- ناهنجاری‌های آدرس MAC

### تشخیص مبتنی بر هاست

#### بررسی حالت Promiscuous
```bash
# Linux
ip link show eth0
# به دنبال پرچم PROMISC بگردید

# بررسی با ifconfig
ifconfig eth0 | grep PROMISC
```

#### بازرسی کش ARP
```bash
# مشاهده جدول ARP
arp -a

# ورودی‌های ARP ثابت (پیشگیری)
arp -s 192.168.1.1 00:11:22:33:44:55
```

## تکنیک‌های پیشگیری

### امنیت شبکه

#### امنیت پورت
```cisco
# پیکربندی سوئیچ Cisco
interface FastEthernet0/1
switchport mode access
switchport port-security
switchport port-security maximum 1
switchport port-security violation shutdown
```

#### DHCP Snooping
```cisco
# فعال کردن DHCP snooping
ip dhcp snooping
ip dhcp snooping vlan 10

# اعتماد به پورت‌های uplink
interface GigabitEthernet0/1
ip dhcp snooping trust
```

#### بازرسی پویای ARP (DAI)
```cisco
# فعال کردن DAI
ip arp inspection vlan 10

# اعتماد به پورت‌ها
interface GigabitEthernet0/1
ip arp inspection trust
```

### رمزگذاری

#### استفاده از پروتکل‌های رمزگذاری شده
- HTTPS به جای HTTP
- SSH به جای Telnet
- SFTP به جای FTP
- IMAPS/POP3S به جای IMAP/POP3
- VPN برای دسترسی از راه دور

#### SSL/TLS
- رمزگذاری ترافیک وب
- اعتبارسنجی گواهی
- Perfect Forward Secrecy

### بخش‌بندی شبکه
- VLAN برای جداسازی
- فایروال بین بخش‌ها
- DMZ برای سرویس‌های عمومی
- شبکه مدیر جداگانه

## ملاحظات قانونی و اخلاقی

### مسائل قانونی
- **قوانین شنود**: غیرقانونی بدون رضایت
- **قانون کلاهبرداری و سوءاستفاده کامپیوتری**: دسترسی غیرمجاز
- **قوانین حریم خصوصی**: نقض GDPR، HIPAA
- **نظارت محل کار**: ممکن است نیاز به افشا داشته باشد

### تست مجاز
- مجوز کتبی لازم
- تعریف واضح دامنه
- مستندسازی یافته‌ها
- پیروی از افشای مسئولانه

## شنود در شبکه‌های بی‌سیم

### شنود بی‌سیم
```bash
# حالت نظارت
sudo airmon-ng start wlan0

# ضبط بسته‌ها
sudo airodump-ng wlan0mon

# ضبط handshake WPA
sudo airodump-ng -c 6 --bssid XX:XX:XX:XX:XX:XX -w capture wlan0mon
```

### آسیب‌پذیری‌های بی‌سیم
- شبکه‌های باز: بدون رمزگذاری
- WEP: به راحتی کرک می‌شود
- WPA/WPA2: ضبط handshake + حمله دیکشنری
- Evil twin: نقطه دسترسی جعلی
- حملات Deauth: مجبور کردن به اتصال مجدد

## بهترین روش‌ها برای دفاع

1. **از رمزگذاری استفاده کنید** برای همه ارتباطات حساس
2. **امنیت پورت را پیاده‌سازی کنید** در سوئیچ‌ها
3. **DHCP snooping و DAI را فعال کنید**
4. **ترافیک شبکه را نظارت کنید** برای ناهنجاری‌ها
5. **از VPN استفاده کنید** برای دسترسی از راه دور
6. **ورودی‌های ARP ثابت** برای سیستم‌های بحرانی
7. **بخش‌بندی شبکه** برای محدود کردن قرار گرفتن در معرض
8. **ممیزی‌های امنیتی منظم** و تست نفوذ
9. **آموزش آگاهی کاربر** درباره پروتکل‌های امن
10. **سنجاق کردن گواهی** برای برنامه‌های بحرانی

## منابع

- Wireshark: https://www.wireshark.org
- tcpdump: https://www.tcpdump.org
- Ettercap: https://www.ettercap-project.org
- آموزش تحلیل بسته
- مبانی امنیت شبکه
