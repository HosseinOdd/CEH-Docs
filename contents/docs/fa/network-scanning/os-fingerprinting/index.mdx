---
title: شناسایی سیستم‌عامل
description: تکنیک‌های شناسایی سیستم‌عامل از طریق تحلیل شبکه
---

## شناسایی سیستم‌عامل چیست؟

شناسایی سیستم‌عامل فرآیند تعیین سیستم‌عامل در حال اجرا بر روی یک هاست هدف با تحلیل ویژگی‌های ترافیک شبکه و پاسخ‌ها است. این اطلاعات برای تنظیم حملات و درک محیط هدف حیاتی است.

## انواع شناسایی سیستم‌عامل

### شناسایی فعال
بسته‌های ساخته شده ویژه را به هدف ارسال می‌کند و پاسخ‌ها را تحلیل می‌کند.

**ویژگی‌ها:**
- دقیق‌تر
- نتایج سریع‌تر
- به راحتی قابل تشخیص
- نیاز به تعامل با هدف دارد

### شناسایی غیرفعال
ترافیک شبکه را بدون تعامل مستقیم نظارت می‌کند.

**ویژگی‌ها:**
- مخفیانه‌تر
- کندتر
- کم‌دقت‌تر
- بدون تعامل با هدف

## نحوه کار شناسایی سیستم‌عامل

### تفاوت‌های پشته TCP/IP

سیستم‌عامل‌های مختلف پشته‌های TCP/IP را به صورت متفاوتی پیاده‌سازی می‌کنند:

**مقادیر TTL (Time To Live):**
- Linux/Unix: 64
- Windows: 128
- Cisco/شبکه: 255

**اندازه پنجره:**
- سیستم‌عامل‌های مختلف از اندازه‌های پنجره پیش‌فرض متفاوت استفاده می‌کنند
- می‌تواند خانواده و نسخه سیستم‌عامل را نشان دهد

**گزینه‌های TCP:**
- MSS (حداکثر اندازه بخش)
- مقیاس‌بندی پنجره
- برچسب‌های زمانی
- SACK (تأیید انتخابی)

### توالی IP ID
- افزایشی (Linux/Unix)
- تصادفی (Windows، سیستم‌های مدرن)
- به ازای هر مقصد (برخی سیستم‌ها)

## شناسایی فعال سیستم‌عامل

### استفاده از Nmap

**تشخیص پایه سیستم‌عامل:**
```bash
sudo nmap -O target.com
```

**تشخیص تهاجمی سیستم‌عامل:**
```bash
sudo nmap -O --osscan-guess target.com
```

**محدود کردن تشخیص سیستم‌عامل:**
```bash
sudo nmap -O --osscan-limit target.com
# فقط هاست‌هایی را اسکن کنید که حداقل یک پورت باز و یک بسته دارند
```

**حداکثر تشخیص سیستم‌عامل:**
```bash
sudo nmap -O --max-os-tries 5 target.com
```

### تکنیک‌های استفاده شده توسط Nmap

**بررسی FIN:**
- بسته FIN به پورت باز ارسال می‌کند
- پاسخ را تحلیل می‌کند

**بررسی فلگ جعلی:**
- فلگ‌های TCP تعریف نشده را تنظیم می‌کند
- بررسی می‌کند سیستم‌عامل چگونه آن را مدیریت می‌کند

**گزینه‌های TCP:**
- ترکیبات مختلف گزینه TCP را تست می‌کند
- پاسخ‌ها را تحلیل می‌کند

**بررسی‌های ICMP:**
- پیام‌های مختلف ICMP ارسال می‌کند
- پاسخ‌ها و پیام‌های خطا را تحلیل می‌کند

## شناسایی غیرفعال سیستم‌عامل

### استفاده از p0f

```bash
# گوش دادن به رابط
sudo p0f -i eth0

# خواندن از فایل pcap
p0f -r capture.pcap

# فیلتر بر اساس هاست
sudo p0f -i eth0 host target.com
```

### چیزهایی که p0f تحلیل می‌کند

**بسته‌های SYN:**
- اندازه پنجره اولیه
- ترتیب گزینه‌های TCP
- حداکثر اندازه بخش
- عامل مقیاس‌بندی پنجره

**بسته‌های SYN+ACK:**
- پاسخ‌های سرور
- گزینه‌های TCP

**ترافیک HTTP:**
- رشته‌های User-Agent
- هدرهای سرور
- امضاهای برنامه

## گرفتن بنر برای تشخیص سیستم‌عامل

### Netcat
```bash
nc target.com 22
nc target.com 80
```

### Telnet
```bash
telnet target.com 22
telnet target.com 25
```

### تشخیص سرویس Nmap
```bash
nmap -sV target.com
```

## امضاهای رایج سیستم‌عامل

### Linux
- TTL: 64
- اندازه پنجره: 5840
- بیت Don't Fragment: تنظیم شده
- گزینه‌های TCP: MSS، SACK، Timestamps، Window Scale

### Windows
- TTL: 128
- اندازه پنجره: 8192 یا 65535
- بیت Don't Fragment: تنظیم شده
- گزینه‌های TCP: MSS، SACK، Window Scale

### macOS
- TTL: 64
- اندازه پنجره: 65535
- مشابه سیستم‌های BSD

### Cisco IOS
- TTL: 255
- رفتارهای خاص پشته TCP/IP

## تکنیک‌های پیشرفته

### تحلیل ICMP
```bash
# ارسال درخواست ICMP echo
ping -c 1 target.com

# تحلیل TTL و سایر پاسخ‌های ICMP
hping3 -1 target.com
```

### بررسی‌های خاص پروتکل

**بنر SSH:**
```bash
nc target.com 22
# پاسخ: SSH-2.0-OpenSSH_7.4 (نشان‌دهنده Linux)
```

**هدر سرور HTTP:**
```bash
curl -I target.com
# Server: Microsoft-IIS/10.0 (نشان‌دهنده Windows)
```

**بنر SMTP:**
```bash
nc target.com 25
# 220 mail.example.com ESMTP Postfix
```

## استفاده از Xprobe2

```bash
# شناسایی پایه سیستم‌عامل
sudo xprobe2 target.com

# حالت پرحرف
sudo xprobe2 -v target.com

# محدوده پورت خاص
sudo xprobe2 -p 1-1000 target.com
```

## تشخیص شناسایی سیستم‌عامل

### سطح شبکه
- نظارت بر الگوهای بسته غیرعادی
- تشخیص بسته‌های ناقص
- شناسایی بررسی‌های ترتیبی
- ردیابی ناهنجاری‌های ICMP

### استفاده از IDS/IPS
- قوانین Snort برای شناسایی سیستم‌عامل
- امضاهای Suricata
- قوانین تشخیص سفارشی

## فرار از شناسایی سیستم‌عامل

### برای مدافعان

**تغییر پشته TCP/IP:**
- تغییر مقادیر TTL
- تصادفی کردن اندازه‌های پنجره
- تغییر گزینه‌های TCP

**استفاده از فایروال‌ها:**
- مسدود کردن بررسی‌های شناسایی
- فیلتر پیام‌های ICMP
- محدودیت نرخ اتصالات

**ابزارهای مبهم‌سازی سیستم‌عامل:**
- IP Personality (ippersonality)
- Honeyd
- Morph

**امنیت شبکه:**
- استقرار سیستم‌های IPS
- استفاده از پروکسی‌های برنامه
- پیاده‌سازی تقسیم‌بندی شبکه

## مثال‌های عملی

### تشخیص کامل سیستم‌عامل
```bash
# اسکن جامع Nmap
sudo nmap -O -sV -T4 --osscan-guess target.com

# با اسکریپت‌های اضافی
sudo nmap -O -sV --script=smb-os-discovery target.com
```

### نظارت غیرفعال
```bash
# شروع p0f در پس‌زمینه
sudo p0f -i eth0 -o /var/log/p0f.log &

# نظارت بر زیرشبکه خاص
sudo p0f -i eth0 'net 192.168.1.0/24'
```

### ترکیب چند تکنیک
```bash
# 1. اسکن فعال
sudo nmap -O target.com

# 2. گرفتن بنر
nc target.com 80

# 3. تشخیص سرویس
nmap -sV -p- target.com
```

## محدودیت‌ها

### مسائل دقت
- فایروال‌ها می‌توانند پاسخ‌ها را تغییر دهند
- Load balancer بر تشخیص تأثیر می‌گذارد
- ماشین‌های مجازی ممکن است hypervisor را نشان دهند
- NAT می‌تواند سیستم‌عامل واقعی را پنهان کند

### چالش‌های تشخیص
- سیستم‌عامل‌های مدرن بسیاری از مقادیر را تصادفی می‌کنند
- ابزارهای امنیتی رفتار پشته را تغییر می‌دهند
- ترافیک رمزگذاری شده امضاها را پنهان می‌کند
- محیط‌های ابری تشخیص را پیچیده می‌کنند

## بهترین روش‌ها

1. **استفاده از روش‌های متعدد**: تکنیک‌های فعال و غیرفعال را ترکیب کنید
2. **تأیید نتایج**: ابزارهای مختلف را مرجع متقابل کنید
3. **در نظر گرفتن زمینه**: توپولوژی شبکه، قوانین فایروال
4. **مستندسازی یافته‌ها**: سوابق دقیق نگه دارید
5. **انطباق قانونی**: همیشه مجوز دریافت کنید

## ابزارهای رایج شناسایی سیستم‌عامل

- **Nmap**: محبوب‌ترین، بسیار دقیق
- **p0f**: شناسایی غیرفعال
- **Xprobe2**: شناسایی فعال پیشرفته
- **hping3**: ساخت بسته سفارشی
- **Nessus**: اسکنر آسیب‌پذیری با تشخیص سیستم‌عامل
- **OpenVAS**: اسکنر آسیب‌پذیری متن‌باز

## موارد استفاده در تست نفوذ

1. **پروفایل هدف**: درک محیط
2. **انتخاب اکسپلویت**: انتخاب اکسپلویت‌های مناسب
3. **برنامه‌ریزی فرار**: تنظیم تکنیک‌های فرار
4. **ارزیابی آسیب‌پذیری**: شناسایی نقص‌های خاص سیستم‌عامل
5. **نقشه‌برداری شبکه**: ایجاد نقشه زیرساخت
